<html>
<head>
  <title>Void Servers - Edit <%= guild.name %></title>
<%- include('../blocks/header') %>
</head>
<%- include('../blocks/navbar', { bot, user }) %>
<body>
<%- include('../blocks/guildtop', { bot, user, guild }) %>
   <div class="container mt-3">
     <% if((server.description == "Short Description") || (server.long == "Long Description") || (server.invite == null)) { %>
    <div class="alert alert-warning alert-dismissible fade show" style="margin-bottom:40px;">
      <h4 class="alert-heading"><i class="fas fa-exclamation-triangle"></i> Unfinished!</h4>
      <hr />
      <ul style=" margin:0;">
     <%- server.description == "Short Description" ? `<li>Make sure to set your <b>Short Description</b>!</li>` : '' %>
     <%- server.long == "Long Description" ? `<li> Make sure to set your <b>Long Description</b>!</li>` : '' %>
     <%- server.invite == null ? `<li> Make sure to set your <b>Server Invite</b>!</li>` : '' %>
   </ul>
   <button type="button" class="close" data-dismiss="alert" aria-label="Close" style="outline:none;">
    <span aria-hidden="true"><i class="fas fa-times"></i></span>
  </button>
   </div>
   <% } %>
  <div class="row">
    <div class="col-md-8 offset-md-2">
      <div class="card mb-8">
  <div class="card-header"><h5 style="padding:0;margin:0;">Edit <%= guild.name %></h5><p style="padding:0;margin:0;">Customize your server's page to your liking!</p></div>
  <div class="card-body">
    <form role="form" id="arooly_cform" class="serverinfo" method="POST" action="/server/<%= server.guildid %>/edit">

      <!--<div class="form-group">
        <label for="inputName">Name*</label>
        <div class="input-group Name">
        <input type="text" class="form-control" id="inputName" name="inputName" placeholder="Name">
        </div>
      </div>-->

      <div class="form-group" style="margin-top:5px;">
        <label class="mb-0" for="inputName"><strong>Short Description</strong></label>
        <small class=" form-text text-muted mt-0 mb-2">A brief description of your server!</small>
        <div class="input-group Name">
        <input type="text" class="form-control" id="shortdesc" name="shortdesc" placeholder="Short Description" value="<%= server.description %>" autocomplete="off" maxlength="200" required>
        </div>
      </div>

      <div class="form-group">
        <label class="mb-0" for="inputName"><strong>Description</strong></label>
        <small class="form-text text-muted mt-0 mb-2">Supports <a href="/markdown" target="_blank">Markdown</a>!</small>
        <div class="input-group Name">
        <textarea type="text" class="form-control" id="longdesc" name="longdesc" placeholder="Long Description" style="min-height:300px; height:300px;" autocomplete="off" required><%= server.long %></textarea>
        </div>
      </div>

      <div class="form-group">
        <label class="mb-0" for="inputName"><strong>Invite Link</strong></label>
        <small class="form-text text-muted mt-0 mb-2">Can also be generated by typing <code>vs.setinvite #channel</code>!</small>
        <div class="input-group Name">
          <div class="input-group-prepend">
          <div class="input-group-text">discord.gg/</div>
        </div>
        <input type="text" class="form-control" id="invitelink" name="invitelink" placeholder="" value="<%= server.invite %>" autocomplete="off" required>
        </div>
      </div>

      <div class="form-group">
          <label class="mb-0" for="backgroundStyle" data-toggle="tooltip" title="Set the background for the top of your server page!"><strong>Background</strong></label>
          <small class="form-text text-muted mt-0 mb-2">Set the background for your server's page!</small>
          <select class="form-control" id="backgroundStyle" required>
            <option value="default" <%= server.styles.background == "default" ? 'selected' : '' %>>Default</option>
            <option disabled>--- Gradients ---</option>
            <option value="rbg" id="rbg" <%= server.styles.background == "rbg" ? 'selected' : '' %>>Red Blue Gradient</option>
            <option value="bgg" id="bgg" <%= server.styles.background == "bgg" ? 'selected' : '' %>>Blue Green Gradient</option>
            <option value="pyb" id="pyb" <%= server.styles.background == "pyb" ? 'selected' : '' %>>Purple Yellow Gradient</option>
            <option value="pcg" id="pcg" <%= server.styles.background == "pcg" ? 'selected' : '' %>>Pink Cyan Gradient</option>
            <option value="oyg" id="oyg" <%= server.styles.background == "oyg" ? 'selected' : '' %>>Orange Yellow Gradient</option>
            <option value="lcg" id="lcg" <%= server.styles.background == "lcg" ? 'selected' : '' %>>Lime Cyan Gradient</option>
            <option value="plg" id="plg" <%= server.styles.background == "plg" ? 'selected' : '' %>>Pink Light-Red Gradient</option>
            <option value="pog" id="pog" <%= server.styles.background == "pog" ? 'selected' : '' %>>Pink Orange Gradient</option>
            <option value="bcg" id="bcg" <%= server.styles.background == "bcg" ? 'selected' : '' %>>Blue Cyan Gradient</option>
            <option value="rdg" id="rdg" <%= server.styles.background == "rdg" ? 'selected' : '' %>>Red Dark-Red Gradient</option>
            <option value="pdg" id="pdg" <%= server.styles.background == "pdg" ? 'selected' : '' %>>Purple Dark-Purple Gradient</option>
            <option disabled>--- Colors ---</option>
            <option value="blk" id="blk" <%= server.styles.background == "blk" ? 'selected' : '' %>>Black</option>
            <option value="dg" id="dg" <%= server.styles.background == "dg" ? 'selected' : '' %>>Dark Grey</option>
            <option value="db" id="db" <%= server.styles.background == "db" ? 'selected' : '' %>>Discord Blurple</option>
            <option value="dnqb" id="dnqb" <%= server.styles.background == "dnqb" ? 'selected' : '' %>>Discord Not quite black</option>
            <option disabled>--- Images ---</option>
            <option value="invitebg" <%= guild.splash ? '' : 'disabled' %> <%= server.styles.background == "invitebg" ? 'selected' : '' %>>Server Invite Background</option>
            <option value="banner" <%= guild.banner ? '' : 'disabled' %> <%= server.styles.background == "banner" ? 'selected' : '' %>>Server Banner Image</option>
            <option value="custom" <%= false == true ? '' : 'disabled' %> <%= server.styles.background == "custom" ? 'selected' : '' %>>Custom Image</option>
          </select>
        </div>

      <div class="form-group" id="tags-box" style="webkit-user-select: none; -ms-user-select: none; user-select: none;">
        <label class="mb-0" data-toggle="tooltip" title="Categorize your server by keywords (e.g. game title)"><strong>Categories</strong></label>
        <small class="form-text text-muted mt-0 mb-2">Select 6 tags maximum!</small>
        <% categories.forEach((c,i) => { %>
        <div class="form-check form-check-inline" style="width:150px;">
            <input type="checkbox" class="form-check-input" id="tag-<%= c %>" value="<%= c %>" name="tag" <%= server.categories.includes(c) ? 'checked' : '' %>>
            <label class="form-check-label" for="tag-<%= c %>"><%= c.toProperCase() %></label>
        </div>
        <% }); %>
    </div>
    <script>
      $(".form-check-input").on('change', function() {
        const tags = [];
        $.each($("input[name='tag']:checked"), function() {
            tags.push($(this).val());
        });
        if(tags.length > 6) {
            this.checked = false;
        }
      });
    </script>

      <button type="submit" class="btn btn-primary">Save</button>

    </form>
  </div>
</div>
  </div>

  <div class="col-md-8 offset-md-2" style="margin-top:50px; margin-bottom:200px;">
<div class="card mb-8">
<div class="card-header"><h5 style="padding:0;margin:0;">Vanity URL</h5><p style="padding:0;margin:0;">Create your own vanity link for your Discord sever!</p></div>
<div class="card-body">

  <form role="form" id="arooly_cform" class="vanity" method="POST" action="/server/<%= server.guildid %>/edit">

    <div class="form-group" style="margin-top:5px;">
      <label for="vanityURL"><strong>Server Link</strong></label>
      <div class="input-group Name">
        <div class="input-group-prepend">
        <div class="input-group-text">di.scord.xyz/</div>
      </div>
      <input type="text" class="form-control" min="3" id="vanityURL" name="vanityURL" placeholder="vanity" value="<%= server.vanity.code %>" autocomplete="off" required>
      </div>
    </div>

    <div class="form-group">
        <label for="vanityAction"><strong>Action</strong></label>
        <select class="form-control" id="vanityAction" required>
          <option disabled selected>Select One</option>
          <option value="join" <%= server.vanity.action == "join" ? 'selected' : '' %>>Join Server</option>
          <option value="page" <%= server.vanity.action == "page" ? 'selected' : '' %>>Server Page</option>
        </select>
      </div>

    <button type="submit" class="btn btn-primary">Save</button>

  </form>
</div>
</div>
</div>
</div>
</div>

<!-- Bootstrap Modals -->
<div class="modal fade" id="errorModal">
  <div class="modal-dialog modal-content">
      <!-- Modal Header -->
      <div class="modal-header">
        <h5 class="modal-title">An error occurred: <code>Unknown</code></h5>
        <button type="button" class="close" data-dismiss="modal">&times;</button>
      </div>

      <!-- Modal body -->
      <div class="modal-body">
        Modal body..
      </div>

      <!-- Modal footer -->
      <div class="modal-footer">
        <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
      </div>
  </div>
</div>

<div class="modal fade" id="successModal">
  <div class="modal-dialog modal-content">
      <!-- Modal Header -->
      <div class="modal-header">
        <h5 class="modal-title">An error occurred: <code>Unknown</code></h5>
        <button type="button" class="close" data-dismiss="modal">&times;</button>
      </div>

      <!-- Modal body -->
      <div class="modal-body">
        Modal body..
      </div>

      <!-- Modal footer -->
      <div class="modal-footer">
        <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
      </div>
  </div>
</div>

<%- include('../blocks/footer') %>
</body>
<style>
.form-group {
  margin-top:25px;
}
</style>
<script type="text/javascript">
$(function() {
    $("form.serverinfo").submit(function (event) {
        event.preventDefault();

        const form = $(this);
        const tags = [];
        $.each($("input[name='tag']:checked"), function() {
            tags.push($(this).val());
        });
        const data = {
            backgroundStyle: $("#backgroundStyle").val() || "default",
            invitelink: $("#invitelink").val() || "huhP4Vs",
            shortdesc: $("#shortdesc").val() || "Short Description",
            longdesc: $("#longdesc").val() || "Long Description",
            tags
        };
        console.log(JSON.stringify(data));
        $.ajax({
            type: form.attr("method"),
            url: form.attr("action"),
            dataType: "json",
            contentType: 'application/json',
            data: JSON.stringify(data),
            success: function (resp) {
              /*$("#successModal > .modal-dialog > .modal-body").html(`${resp.message}`);
              $("#successModal > .modal-dialog > .modal-header > .modal-title").html(`${resp.code}`);
              $("#successModal > .modal-dialog > .modal-footer").html(`<a class="btn btn-danger" href="${resp.redirect}">Close</a>`);
              $('#successModal').modal('show');*/
              window.location = resp.redirect;
                // if(resp.code === "OK") window.location = resp.redirect;
                //else window.location.replace("/bots/<%# botInfo.id %>/edit?success=false&error=" + resp.e);
            },
            error: function (resp) {
              $("#errorModal > .modal-dialog > .modal-body").html(`${resp.responseJSON.message}`);
              $("#errorModal > .modal-dialog > .modal-header > .modal-title").html(`An error occurred: <code>${resp.responseJSON.code}</code>`);
              $('#errorModal').modal('show');
            }
        });
    });
    $("form.vanity").submit(function (event) {
        event.preventDefault();

        const form = $(this);
        const tags = [];
        $.each($("input[name='tag']:checked"), function() {
            tags.push($(this).val());
        });
        const data = {
            vanityURL: $("#vanityURL").val() || null,
            vanityAction: $("#vanityAction").val() || "join",
        };
        console.log(JSON.stringify(data));
        $.ajax({
            type: form.attr("method"),
            url: form.attr("action"),
            dataType: "json",
            contentType: 'application/json',
            data: JSON.stringify(data),
            success: function (resp) {
              /*$("#successModal > .modal-dialog > .modal-body").html(`${resp.message}`);
              $("#successModal > .modal-dialog > .modal-header > .modal-title").html(`${resp.code}`);
              $("#successModal > .modal-dialog > .modal-footer").html(`<a class="btn btn-danger" href="${resp.redirect}">Close</a>`);
              $('#successModal').modal('show');*/
              window.location = resp.redirect;
                // if(resp.code === "OK") window.location = resp.redirect;
                //else window.location.replace("/bots/<%# botInfo.id %>/edit?success=false&error=" + resp.e);
            },
            error: function (resp) {
              $("#errorModal > .modal-dialog > .modal-body").html(`${resp.responseJSON.message}`);
              $("#errorModal > .modal-dialog > .modal-header > .modal-title").html(`An error occurred: <code>${resp.responseJSON.code}</code>`);
              $('#errorModal').modal('show');
            }
        });
    });
});
</script>
</html>
